<p-breadcrumb [model]="breadcrumbItems"></p-breadcrumb>
<div class="card">
    <!-- <div class="font-semibold text-xl mb-4">
      <p-button (click)="addNewSite()" icon="pi pi-plus" label="Add New Site" [raised]="true" severity="info" />
    </div> -->
    <div>
        @for (message of messages(); track message; let first = $first) {
            <p-message [life]="message.life" closable [severity]="message.severity" [text]="message.content" styleClass="mb-2 mt-2" />
        }
        <p-table #siteTable [value]="siteData" showGridlines stripedRows size="small" [loading]="loading" [paginator]="true" [rows]="20"
            [globalFilterFields]="['name']">
            <ng-template #caption>
                <div class="flex">
                    <p-button (click)="addNewSite()" icon="pi pi-plus" label="Add New Site" [raised]="true" severity="info" />
                    <p-iconfield iconPosition="left" class="ml-auto">
                        <p-inputicon>
                            <i class="pi pi-search"></i>
                        </p-inputicon>
                        <input pInputText type="text" (input)="siteTable.filterGlobal($any($event.target).value, 'contains')" placeholder="Search Name" />
                    </p-iconfield>
                </div>
            </ng-template>
            <ng-template pTemplate="header">
                <tr>
                <th style="width:45px">SN</th>
                <th>Name</th>
                <th>Priority</th>
                <th>Created At</th>
                <th>Action</th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-Site let-rowIndex="rowIndex">
                <tr>
                <td>{{ rowIndex+1 }}</td>
                <td>
                    <!-- <a [routerLink]="[`/superadmin/site-details/${Site.id}`]" class="text-blue-500 underline">{{ Site.name }}</a> -->
                    {{ Site.name }}
                </td>
                <td>
                    <p-tag severity="{{Site.priority ? 'success' : 'secondary'}}" value="{{Site.priority ? 'Top Priority' : 'Make It Priority'}}" class="cursor-pointer" (click)="changeSitePriority(Site)"/>
                    <!-- <p-tag *ngIf="!Site.priority" severity="secondary" value="Blocked" /> -->
                    <!-- <p-toggleswitch [(ngModel)]="Site.priority" (onChange)="changeSitePriority(Site)" /> -->
                </td>
                <td>{{ Site.created_at | date:'dd-MM-yyyy' }}</td>
                <td>
                    <p-button (click)="selectSite(Site)" icon="pi pi-pen-to-square" severity="info" />
                </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>

<p-dialog header="{{selectedSite ? 'Update Site' : 'Add Site'}}" (onHide)="onCloseSiteDetailsModel()" [(visible)]="visibleSiteManageDialog" [modal]="true" [closable]="true"  [style]="{width: '300px'}">
    <form [formGroup]="siteForm" (ngSubmit)="onSubmitSiteManageForm()" class="p-fluid">
        <div class="grid grid-cols-2 gap-6">

            <!-- name -->
            <div class="field col-span-12">
                <label class="block" for="name">name</label>
                <input id="name" pInputText formControlName="name" class="w-full" placeholder="Enter Site Name" />
                <small *ngIf="siteForm.get('name')?.invalid && siteForm.get('name')?.touched" class="p-error">
                Name is required and must be under 255 characters.
                </small>
            </div>
        </div>
        <div class="field mt-3 text-right">
            <p-button [loading]="addUpdateLoading" type="submit" label="{{selectedSite ? 'Update' : 'Add'}}" [disabled]="siteForm.invalid" />
        </div>
    </form>
</p-dialog>
<p-confirmDialog></p-confirmDialog>